<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Dinámico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .calendar-cell {
            height: 60px;
            border: 1px solid #dee2e6;
            vertical-align: top;
            position: relative;
            overflow: hidden; /* Asegura que el contenido no se desborde */
        }
        
        .event {
            padding: 2px;
            margin: 1px;
            font-size: 0.8em;
            color: white;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-sizing: border-box;
            text-align: center;
            overflow: hidden; /* Asegura que el texto no se desborde */
        }
        
        .allowed {
            background-color: #28a745;
        }
        
        .not-allowed {
            background-color: #dc3545;
        }
        
        .day-header {
            background-color: #7CFFD9 !important;
            font-weight: bold;
            text-align: center;
            vertical-align: middle;
            padding: 10px;
        }
        th {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Calendario Dinámico</h1>
        <div class="row mb-3">
            <div class="col">
                <button id="prevWeek" class="btn btn-secondary">&lt; Semana anterior</button>
            </div>
            <div class="col text-center">
                <h2 id="currentWeek"></h2>
            </div>
            <div class="col text-end">
                <button id="nextWeek" class="btn btn-primary">Semana siguiente &gt;</button>
            </div>
        </div>
        <div id="calendar"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Datos de ejemplo (esto se podría cargar desde un archivo JSON)
        const personas = [
            {
                nombre: "Juan Pérez",
                horarios: [
                    { fecha: "2024-07-22", horasPermitidas: ["10:00", "11:00", "12:00"], horasNoPermitidas: ["14:00", "15:00"] },
                    { fecha: "2024-07-24", horasPermitidas: ["14:00", "15:00", "16:00"], horasNoPermitidas: ["09:00", "10:00"] }
                ]
            }
            //{
            //    nombre: "María García",
            //    horarios: [
            //        { fecha: "2024-07-23", horasPermitidas: ["09:00", "10:00", "11:00"], horasNoPermitidas: ["14:00", "15:00"] },
            //      { fecha: "2024-07-25", horasPermitidas: ["15:00", "16:00", "17:00"], horasNoPermitidas: ["10:00", "11:00"] }
            //    ]
            //}
        ];

        let currentDate = new Date();

        function getWeekDates(date) {
            const week = [];
            const current = new Date(date);
            current.setDate(current.getDate() - current.getDay() + 1); // Set to Monday
            for (let i = 0; i < 5; i++) {
                week.push(new Date(current));
                current.setDate(current.getDate() + 1);
            }
            return week;
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function formatHour(hour) {
            return `${hour.toString().padStart(2, '0')}:00`;
        }

        function updateCalendar() {
            const calendarEl = document.getElementById('calendar');
            const weekDates = getWeekDates(currentDate);
            const weekStart = weekDates[0];
            const weekEnd = weekDates[4];

            document.getElementById('currentWeek').textContent = `${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;

            let calendarHTML = '<table class="table table-bordered">';
            calendarHTML += '<thead><tr><th>Hora</th>';
            weekDates.forEach(date => {
                calendarHTML += `<th class="day-header">${date.toLocaleDateString('es-ES', { weekday: 'short' })}<br>${date.getDate()}</th>`;
            });
            calendarHTML += '</tr></thead><tbody>';

            for (let hour = 8; hour <= 20; hour++) {
                calendarHTML += '<tr>';
                calendarHTML += `<td>${formatHour(hour)}</td>`;
                weekDates.forEach(date => {
                    calendarHTML += '<td class="calendar-cell">';
                    personas.forEach(persona => {
                        const horario = persona.horarios.find(h => h.fecha === formatDate(date));
                        if (horario) {
                            const formattedHour = formatHour(hour);
                            if (horario.horasPermitidas.includes(formattedHour)) {
                                calendarHTML += `<div class="event allowed">${persona.nombre}: Disponible</div>`;
                            } else if (horario.horasNoPermitidas.includes(formattedHour)) {
                                calendarHTML += `<div class="event not-allowed">${persona.nombre}: No disponible</div>`;
                            }
                        }
                    });
                    calendarHTML += '</td>';
                });
                calendarHTML += '</tr>';
            }

            calendarHTML += '</tbody></table>';
            calendarEl.innerHTML = calendarHTML;

            // Deshabilitar el botón de semana anterior si estamos en la semana actual
            const today = new Date();
            const currentWeekStart = new Date(today.setDate(today.getDate() - today.getDay() + 1));
            document.getElementById('prevWeek').disabled = weekStart <= currentWeekStart;

            // Deshabilitar el botón de semana siguiente si estamos a más de 2 meses en el futuro
            const twoMonthsLater = new Date();
            twoMonthsLater.setMonth(twoMonthsLater.getMonth() + 2);
            document.getElementById('nextWeek').disabled = weekEnd >= twoMonthsLater;
        }

        document.getElementById('prevWeek').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 7);
            updateCalendar();
        });

        document.getElementById('nextWeek').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 7);
            updateCalendar();
        });

        updateCalendar();
    </script>
</body>
</html>